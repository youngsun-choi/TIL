<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HTML5로 이모티콘 카드 만들기</title>
<link rel="stylesheet" href="mycard.css">
</head>
<body>
<h1>HTML5로 이모티콘 카드 만들기</h1>
<button onclick="save();">저장하기</button>
<button onclick="restore();">읽어오기</button>
<button onclick="clearAll();">지우기</button><br><br>
배경 컬러 설정 : <input type="color" id="bgcolor"> 
테두리 컬러 설정 : <input type="color" id="stcolor"><br>
메시지 컬러 설정 : <input type="color" id="txcolor"> 
입력 메시지 : <input type="text" id="message"><br><br>
<section>
	<canvas id="cv1"></canvas>
</section>	
<section id="picturesbox">
	<img id="image1" src="monster1.gif">
    <img id="image2" src="monster2.gif">
    <img id="image3" src="monster3.gif">
    <img id="image4" src="monster4.gif">
</section>
	<!-- <canvas id="cv2"></canvas> -->

<script>
var myCanvas=document.getElementById("cv1");
//var imgCanvas=document.getElementById("cv2");
var context=myCanvas.getContext("2d");
function save() {
	myCanvas = document.getElementById("cv1");
	alert(myCanvas.toDataURL());
	localStorage.setItem("canvas", myCanvas.toDataURL());
}
function clearAll() { //clear로 이름을 주면 안된다!!!
	console.log("CLEAR");
	context = myCanvas.getContext("2d"); //2차원 객체에 대한 2d context를 가져온다.
	context.clearRect(0, 0, myCanvas.width, myCanvas.height);
}
function restore() {
	console.log("RESTORE");
	var img = new Image();
	img.src = localStorage.getItem("canvas"); //img.src : 메모리상에 이미지를 넣는다는 것이다. 
	img.onload = function() { //load는 window객체, body태그, img태그에서만 발생한다. 
	context.drawImage(img, 0, 0);
	}
} 
document.getElementById("bgcolor").onchange = function(){
	context.fillStyle = this.value;
	context.fillRect(0, 0, myCanvas.width, myCanvas.height);
	//document.getElementById("cv1").style.backgroundColor=this.value;
} 
document.getElementById("stcolor").onchange = function(){
	context.strokeStyle = this.value;
	context.strokeRect(0, 0, myCanvas.width, myCanvas.height);
} 

function clickCanvas1(e){
	e.preventDefault();
	var rect = myCanvas.getBoundingClientRect(); 
	var posX = e.clientX - rect.left;
	var posY = e.clientY - rect.top;
	/* var posX = e.pageX - myCanvas.offsetLeft;
	var posY = e.pageY - myCanvas.offsetTop; */
	var message=document.getElementById("message").value.trim();
	if(message != ""){
		console.log(posX+", "+posY);
		context.font = "12px Arial";
		//context.textAlign = "left";
		//context.textBaseline = "middle";
		context.fillStyle = document.getElementById("txcolor").value;
		context.fillText(message, posX, posY);
	}else
		alert("메세지를 입력해주세요!");
}
myCanvas.addEventListener("click",clickCanvas1); 
</script>
</body>
</html>